<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-list/iron-list.html">

<link rel="import" href="zr-backend-data.html">
<link rel="import" href="zr-tmpl-page-layout.html">
<link rel="import" href="zr-common.html">
<link rel="import" href="zr-styles.html">

<link rel="lazy-import" href="zr-tmpl-button.html">
<link rel="lazy-import" href="zr-catalog-overlay-new.html">

<dom-module id="zr-dashboard">
  <template>

    <style include="content-styles list-styles show-styles">
      .empty {
        text-align: center;
        border: 1px solid green;
        border-radius: 4px;
        margin: 16px;
        padding: 32px 16px;
        box-shadow: 0 4px 4px var(--zr-primary-color);
      }
      .empty__image {
        width: 96px;
        height: 96px;
      }
    </style>

    <zr-backend-data
      id="backend"
      set-path="[[_computeCollectionsPath(userId)]]"
      set-data="{{_collections}}"
      loading="{{loadingCollections}}"></zr-backend-data>

    <zr-tmpl-page-layout
      menu
      title="[[appName]]"
      loading="[[loadingCollections]]">

      <zr-tmpl-button
        slot="action"
        label="NEW COLLECTION"
        icon="add-collection"
        hidden$="[[_computeShowEmptyContent(_collections)]]"
        on-click="_newCollectionTapped"
        small="[[smallScreen]]"></zr-tmpl-button>

      <div id="content" slot="content" class="content__list">

        <iron-list 
          id="ironList"
          hidden$="[[_computeShowEmptyContent(_collections)]]"
          items="[[_collections]]"
          class="list"
          as="collection">
          <template>
            <div class$="table__item-container [[_notifyResize(index, _collections.length)]]">
              <a class="table__item" href="[[_computeUrlCollection(collection)]]">
                <div class="table__item__detail">
                  <span class="table__item--primary-text">[[collection.label]]</span>
                  <span class="table__item--secondary-text">[[collection.description]]</span>
                </div>
              </a>
            </div>
          </template>
        </iron-list>

        <div class="empty" hidden$="[[!_computeShowEmptyContent(_collections)]]">
          <img class="empty__image" src="../images/empty.jpg">
          <h3>You don't have any collection yet.</h3>
          <h4>Create your first one now, what would you say??</h4>
          <zr-tmpl-button
            label="CREATE MY FIRST COLLECTION"
            on-click="_newCollectionTapped"></zr-tmpl-button>
        </div>

      </div>

    </zr-tmpl-page-layout>

    <zr-catalog-overlay-new 
      id="newCollectionOverlay"
      always-on-top
      no-cancel-on-outside-click
      small-screen="[[smallScreen]]"
      medium-screen="[[mediumScreen]]"></zr-catalog-overlay-new>

  </template>

  <script>

    class ZRDashboard extends Polymer.Element {

      static get is() { return 'zr-dashboard'; }

      static get properties() {
        return {

          appName: String,

          userId: Object,

          _collections: Object,

          loadingCollections: Boolean,

          smallScreen: Boolean,

          mediumScreen: Boolean
  
        }
      }

      _newCollectionTapped() {
        this.$.newCollectionOverlay.open();
      }

      _computeCollectionsPath(userId) {
        return userId ? 
          `/user_collections/${userId}/collections` : null;
      }

      _computeUrlCollection(collection) {
        const collectionId = this.$.backend.getId(collection);
        return `/catalog/${collectionId}`;
      }

      _computeShowEmptyContent(_collections) {
        return !_collections || !_collections.length;
      }

      _notifyResize() {
        window.setTimeout(_ => {
          this.$.ironList.notifyResize();
        });
      }

    }

    window.customElements.define(ZRDashboard.is, ZRDashboard);

  </script>
</dom-module>
